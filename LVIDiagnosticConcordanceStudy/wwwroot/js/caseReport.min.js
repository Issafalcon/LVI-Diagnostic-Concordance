"use strict";$(document).ready(function(){function t(n){$.ajax({type:"GET",url:window.location.pathname+"?handler=PreTestProbabilityViewComponent&"+jQuery.param({preTestProb:n})}).done(function(n){$("#preTestProbabilityPlaceholder").html(n);$("[data-toggle=popover]").popover();$("#preTestProbabilityPlaceholder").fadeIn("300")})}function r(){var i,r,u;$("[data-toggle=popover]").popover("dispose");i=o();i.TumourGrade&&i.NumberofLVI?(r=$("#caseReport"),s(),r.length===1&&r.valid()?(u=window.location.pathname,$.ajax({type:"GET",url:u+"?handler=AdditionalProbabilityData&"+jQuery.param(i),contentType:"application/json",dataType:"json"}).done(function(n){t(n.preTestProbability);c(n)})):(r.validate().showErrors(),n())):(i.NumberofLVI||n(),i.TumourGrade||(n(),e()))}function c(n){for(var r,f,i,t=0;t<n.observedYValues.length;t++)if(n.observedYValues[t]!==0){i=n.observedYValues[t];break}r=window.location.pathname;f={preTestProb:n.preTestProbability,postTestProb:n.postTestProbability,observedValue:i,lviReported:n.lviReported};$.ajax({type:"GET",url:r+"?handler=AdditionalProbabilityViewComponent&"+jQuery.param(f)}).done(function(t){$("#additionalProbabilityDataPlaceholder").fadeIn("300",function(){const r=$("#interventionSubmitDiv");$("#additionalProbabilityDataPlaceholder").html(t);$("[data-toggle=popover]").popover();$("#additionalProbabilityDataPlaceholder").addClass("card");$("#probabilityChartPlaceholder").after(r);a(n);const i=document.getElementById("codeInput");i!==null&&(i.onpaste=function(n){n.preventDefault()});$("#interventionSubmit").click(l);$("#interventionReportSubmit").click(u)})})}function u(){var n=$("#caseReport");s();n.length===1&&n.valid()?$("#interventionGroupModal").modal("show"):n.validate().showErrors()}function l(){$("#confirmationCode").length?$("#codeInput").val()===$("#confirmationCode").text()?f():$("#codeInputError").text("The code does not match. Please try again."):f()}function f(){var n=$("#caseReport").serialize(),t=window.location.pathname;$.ajax({type:"POST",url:t+"?handler=Submitted&"+jQuery.param({isFromClient:!0}),data:n,headers:{RequestVerificationToken:$('input:hidden[name="__RequestVerificationToken"]').val()}}).done(function(n){window.location.href=n.redirectUrl})}function e(){$("#preTestProbabilityPlaceholder").fadeOut("300");$("#preTestProbabilityPlaceholder").empty()}function n(){$("#additionalProbabilityDataPlaceholder").fadeOut("300");$("#additionalProbabilityDataPlaceholder").removeClass("card");$("#caseReport").append($("#interventionSubmitDiv"));$("#additionalProbabilityDataPlaceholder").empty()}function o(){return{PatientAge:$("#CaseReportViewModel_PatientAge")[0].value,TumourSize:$("#CaseReportViewModel_TumourSize")[0].value,TumourGrade:$("#CaseReportViewModel_TumourGrade")[0].value,NumberofLVI:$("#CaseReportViewModel_NumberofLVI")[0].value}}function s(){Number.isInteger(Number($("#CaseReportViewModel_NumberofLVI")[0].value))?h($("#CaseReportViewModel_NumberofLVI"),""):h($("#CaseReportViewModel_NumberofLVI"),"The Number Of LVI must be an integer of 0 or greater")}function h(n,t){$(n).rules("add",{forcibleerror:!0,messages:{forcibleerror:function(){return t}}});var i=!1;t&&(i=!0);$(n)[0].dataset.isForced=i;$(n).valid()}function a(n){var t=document.getElementById("probabilityChartPlaceholder").getContext("2d"),i=new Chart(t,{type:"bar",data:{labels:n.chartXAxis,datasets:[{label:"Theoretical Probability of LVI",data:n.theoreticalYValues,backgroundColor:"rgba(34, 167, 240, 0.5)",borderColor:"rgba(34, 167, 240, 0.5)",borderWidth:1},{label:"Observed Probability of LVI",data:n.observedYValues,backgroundColor:"rgba(165, 55, 253, 0.5)",borderColor:"rgba(165, 55, 253, 0.5)",borderWidth:1}]},options:{responsive:!0,title:{display:!0,text:"Probability Based On Cumulative LVI"},scales:{yAxes:[{ticks:{beginAtZero:!0},scaleLabel:{display:!0,labelString:"Probability of Having LVI"}}],xAxes:[{ticks:{beginAtZero:!0},scaleLabel:{display:!0,labelString:"Cumulative Cases Reported As LVI Positive"}}]}}})}$("#CaseReportViewModel_TumourGrade").change(function(){var i=o();if($("[data-toggle=popover]").popover("dispose"),!i.TumourGrade){n();e();return}i.NumberofLVI?r():$.ajax({type:"GET",url:window.location.pathname+"?handler=PreTestProbabilityData&"+jQuery.param(i),contentType:"application/json",dataType:"json"}).done(function(n){$("#preTestProbabilityPlaceholder").hide();t(n)})});var i=null;$("#CaseReportViewModel_NumberofLVI").keyup(function(){clearTimeout(i);i=setTimeout(r,500)});$("#interventionReportSubmit").click(u);$.validator.addMethod("forcibleerror",function(n,t){return $(t)[0].dataset.isForced!=="true"})});