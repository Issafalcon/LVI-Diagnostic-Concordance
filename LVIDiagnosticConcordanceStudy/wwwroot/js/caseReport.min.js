"use strict";$(document).ready(function(){function r(n){$.ajax({type:"GET",url:window.location.pathname+"?handler=PreTestProbabilityViewComponent&"+jQuery.param({preTestProb:n})}).done(function(n){$("#preTestProbabilityPlaceholder").html(n);$("[data-toggle=popover]").popover();$("#preTestProbabilityPlaceholder").fadeIn("300")})}function u(){var n,i,u;$("[data-toggle=popover]").popover("dispose");n=s();n.TumourGrade&&n.NumberofLVI?(i=$("#caseReport"),h(),i.length===1&&i.valid()?(u=window.location.pathname,$.ajax({type:"GET",url:u+"?handler=AdditionalProbabilityData&"+jQuery.param(n),contentType:"application/json",dataType:"json"}).done(function(n){r(n.preTestProbability);l(n)})):(i.validate().showErrors(),t())):(n.NumberofLVI||t(),n.TumourGrade||(t(),o()))}function l(n){for(var r,u,i,t=0;t<n.observedYValues.length;t++)if(n.observedYValues[t]!==0){i=n.observedYValues[t];break}r=window.location.pathname;u={preTestProb:n.preTestProbability,postTestProb:n.postTestProbability,observedValue:i,lviReported:n.lviReported};$.ajax({type:"GET",url:r+"?handler=AdditionalProbabilityViewComponent&"+jQuery.param(u)}).done(function(t){$("#additionalProbabilityDataPlaceholder").fadeIn("300",function(){const r=$("#interventionSubmitDiv");$("#additionalProbabilityDataPlaceholder").html(t);$("[data-toggle=popover]").popover();$("#additionalProbabilityDataPlaceholder").addClass("card");$("#probabilityChartPlaceholder").after(r);y(n);const i=document.getElementById("codeInput");i!==null&&(i.onpaste=function(n){n.preventDefault()});$("#interventionSubmit").click(a);$("#interventionReportSubmit").click(f)})})}function f(){var n=$("#caseReport");h();n.length===1&&n.valid()?$("#interventionGroupModal").modal("show"):n.validate().showErrors()}function a(){$("#confirmationCode").length?$("#codeInput").val()===$("#confirmationCode").text()?e():$("#codeInputError").text(n==="en-GB"?"The code does not match. Please try again.":"El codigo ingresado no coincide con el suministrado. Intente nuevamente"):e()}function e(){var n=$("#caseReport").serialize(),t=window.location.pathname;$.ajax({type:"POST",url:t+"?handler=Submitted&"+jQuery.param({isFromClient:!0}),data:n,headers:{RequestVerificationToken:$('input:hidden[name="__RequestVerificationToken"]').val()}}).done(function(n){window.location.href=n.redirectUrl})}function o(){$("#preTestProbabilityPlaceholder").fadeOut("300");$("#preTestProbabilityPlaceholder").empty()}function t(){$("#additionalProbabilityDataPlaceholder").fadeOut("300");$("#additionalProbabilityDataPlaceholder").removeClass("card");$("#caseReport").append($("#interventionSubmitDiv"));$("#additionalProbabilityDataPlaceholder").empty()}function s(){return{PatientAge:$("#CaseReportViewModel_PatientAge")[0].value,TumourSize:$("#CaseReportViewModel_TumourSize")[0].value,TumourGrade:$("#CaseReportViewModel_TumourGrade")[0].value,NumberofLVI:$("#CaseReportViewModel_NumberofLVI")[0].value}}function h(){Number.isInteger(Number($("#CaseReportViewModel_NumberofLVI")[0].value))?c($("#CaseReportViewModel_NumberofLVI"),""):c($("#CaseReportViewModel_NumberofLVI"),n==="en-GB"?"The Number Of LVI must be an integer of 0 or greater":"El numero de PV debe ser un numero entero mayor o igual a 0")}function c(n,t){$(n).rules("add",{forcibleerror:!0,messages:{forcibleerror:function(){return t}}});var i=!1;t&&(i=!0);$(n)[0].dataset.isForced=i;$(n).valid()}function v(n){for(var t,r=n+"=",f=decodeURIComponent(document.cookie),u=f.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)===" ";)t=t.substring(1);if(t.indexOf(r)===0)return t.substring(r.length,t.length)}return""}function y(t){var i=document.getElementById("probabilityChartPlaceholder").getContext("2d"),r=new Chart(i,{type:"bar",data:{labels:t.chartXAxis,datasets:[{label:n==="en-GB"?"Theoretical probability to every possible combination":"Probabilidad teórica para todas las combinaciones combinaciones posibles",data:t.theoreticalYValues,backgroundColor:"rgba(34, 167, 240, 0.5)",borderColor:"rgba(34, 167, 240, 0.5)",borderWidth:1},{label:n==="en-GB"?"Probability based on LVI positive cases reported by the user":"Probabilidad basada en Casos PV positivos ingresados por el usuario",data:t.observedYValues,backgroundColor:"rgba(165, 55, 253, 0.5)",borderColor:"rgba(165, 55, 253, 0.5)",borderWidth:1}]},options:{responsive:!0,title:{display:!0,text:n==="en-GB"?"Chance of a correct answer considering the number of LVI cases reported as positive by the user":"Probabilidad de que sus respuesta sean correctas según numero de casos informados como positivos para permeación vascular (pv)"},tooltips:{enabled:!0},legend:{display:!0},scales:{yAxes:[{ticks:{beginAtZero:!0},scaleLabel:{display:!0,labelString:n==="en-GB"?"Probability of Having LVI":"Probability of Having LVI"}}],xAxes:[{ticks:{beginAtZero:!0},scaleLabel:{display:!0,labelString:n==="en-GB"?"Cumulative Cases Reported As LVI Positive":"Cumulative Cases Reported As LVI Positive"}}]}}})}var n=/c=(.+-.+)\|/.exec(v(".AspNetCore.Culture"))[1],i;$("#CaseReportViewModel_TumourGrade").change(function(){var n=s();if($("[data-toggle=popover]").popover("dispose"),!n.TumourGrade){t();o();return}n.NumberofLVI?u():$.ajax({type:"GET",url:window.location.pathname+"?handler=PreTestProbabilityData&"+jQuery.param(n),contentType:"application/json",dataType:"json"}).done(function(n){$("#preTestProbabilityPlaceholder").hide();r(n)})});i=null;$("#CaseReportViewModel_NumberofLVI").keyup(function(){clearTimeout(i);i=setTimeout(u,500)});$("#interventionReportSubmit").click(f);$.validator.addMethod("forcibleerror",function(n,t){return $(t)[0].dataset.isForced!=="true"})});